
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Move Water Move</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      background-color: #f5f5f5;
    }
    h1 {
      margin-top: 20px;
    }
    .board {
      display: flex;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
      width: 300px;
      margin: 40px auto;
      position: relative;
    }
    .bowl {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      background-color: #fff;
      border: 3px solid #888;
      margin: 10px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
      cursor: pointer;
      transition: transform 0.2s, border-color 0.2s;
    }
    .active-player {
      border-color: royalblue !important;
    }
    .icon {
      font-size: 24px;
    }
    #controls {
      margin-top: 20px;
    }
    #message, #log {
      font-size: 16px;
      margin-top: 10px;
      color: #333;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      margin: 5px;
      cursor: pointer;
    }
    #log {
      max-width: 400px;
      margin: 20px auto;
      text-align: left;
      background-color: #fff;
      border: 1px solid #ccc;
      padding: 10px;
      height: 150px;
      overflow-y: scroll;
    }
    #howToPlay {
      position: fixed;
      top: 20px;
      right: 20px;
      cursor: pointer;
      font-size: 20px;
      background: none;
      border: none;
    }
    #modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
    }
    #modal-content {
      background: white;
      padding: 20px;
      border-radius: 8px;
      width: 80%;
      max-width: 400px;
    }
  </style>
</head>
<body>
  <h1>Move Water Move</h1>
  <button id="howToPlay" onclick="showModal()">‚ùî</button>
  <div class="board" id="board">
    <!-- Player Bowls (0-2), Osi (3-5), Obasa (6-8) -->
    ${[..."Rain River Clouds Rain River Clouds Rain River Clouds".split(" ")].map((el, i) => `
      <div class="bowl" id="bowl${i}">
        <div class="icon" id="icon${i}">${el === "Rain" ? "üåßÔ∏è" : el === "River" ? "üåä" : "‚òÅÔ∏è"}</div>
        <div id="label${i}">${el}</div>
        <div id="count${i}">0</div>
      </div>
    `).join("")}
  </div>

  <div id="controls">
    <button onclick="rollDice()">Roll Dice üé≤</button>
    <button onclick="restartGame()">Restart</button>
    <div id="message">Your element: <strong id="current-element">Rain</strong></div>
    <div id="beads-remaining"></div>
  </div>

  <div id="log"></div>

  <div id="modal">
    <div id="modal-content">
      <h2>How to Play</h2>
      <p>You control one of three water elements: Rain, River, or Clouds. Your goal is to get your current element to 21 seeds.</p>
      <p>Roll the die. If you roll a 1, your element changes (rotates). If not, add the number of seeds one by one to any bowls.</p>
      <p>After your turn, AI players Osi and Obasa take their turns. First to reach 21 wins!</p>
      <button onclick="hideModal()">Close</button>
    </div>
  </div>

  <script>
    const logEl = document.getElementById("log");
    const playerOffset = 0, osiOffset = 3, obasaOffset = 6;
    let players = ["You", "Osi", "Obasa"];
    let boards = [
      [{label: "Rain", icon: "üåßÔ∏è", count: 0}, {label: "River", icon: "üåä", count: 0}, {label: "Clouds", icon: "‚òÅÔ∏è", count: 0}],
      [{label: "Rain", icon: "üåßÔ∏è", count: 0}, {label: "River", icon: "üåä", count: 0}, {label: "Clouds", icon: "‚òÅÔ∏è", count: 0}],
      [{label: "Rain", icon: "üåßÔ∏è", count: 0}, {label: "River", icon: "üåä", count: 0}, {label: "Clouds", icon: "‚òÅÔ∏è", count: 0}]
    ];
    let indices = [0, 0, 0]; // Player, Osi, Obasa rotation index
    let beadsToAdd = 0;

    function updateDisplay() {
      for (let p = 0; p < 3; p++) {
        for (let i = 0; i < 3; i++) {
          const idx = p * 3 + i;
          const bowl = document.getElementById("bowl" + idx);
          document.getElementById("icon" + idx).textContent = boards[p][i].icon;
          document.getElementById("label" + idx).textContent = boards[p][i].label;
          document.getElementById("count" + idx).textContent = boards[p][i].count;
          bowl.classList.remove("active-player");
          if (i === indices[p] && p === 0) bowl.classList.add("active-player");
        }
      }
      document.getElementById("current-element").textContent = boards[0][indices[0]].label;
    }

    function rollDice() {
      if (checkWin()) return;
      beadsToAdd = Math.floor(Math.random() * 6) + 1;
      if (beadsToAdd === 1) {
        rotateBoard(0);
        log("You rolled a 1. Switched to " + boards[0][indices[0]].label + ".");
      } else {
        log("You rolled a " + beadsToAdd + ". Tap a bowl to place seeds.");
      }
      document.getElementById("beads-remaining").textContent = `Seeds left: ${beadsToAdd}`;
      updateDisplay();
    }

    function rotateBoard(p) {
      boards[p].unshift(boards[p].pop());
      indices[p] = 0;
    }

    function addBead(i) {
      if (beadsToAdd > 0 && !checkWin()) {
        const p = Math.floor(i / 3);
        const idx = i % 3;
        boards[p][idx].count += 1;
        beadsToAdd--;
        updateDisplay();
        document.getElementById("beads-remaining").textContent = `Seeds left: ${beadsToAdd}`;
        if (checkWin()) return;
        if (beadsToAdd === 0) aiTurn();
      }
    }

    function aiTurn() {
      for (let p = 1; p <= 2; p++) {
        if (checkWin()) return;
        let roll = Math.floor(Math.random() * 6) + 1;
        let logStr = `${players[p]} rolls ${roll}`;
        log(logStr);
        if (roll === 1) {
          rotateBoard(p);
          log(`${players[p]} rotates to ${boards[p][indices[p]].label}`);
        } else {
          let total = roll;
          let aiIndex = indices[p];
          let currentBowl = boards[p][aiIndex];
          let toWin = 21 - currentBowl.count;
          if (toWin <= roll) {
            currentBowl.count += roll;
            log(`${players[p]} adds ${roll} to ${currentBowl.label}`);
          } else {
            while (total > 0) {
              let r = Math.floor(Math.random() * 3);
              let amt = Math.min(Math.floor(Math.random() * total) + 1, total);
              boards[p][r].count += amt;
              total -= amt;
              log(`${players[p]} adds ${amt} to ${boards[p][r].label}`);
            }
          }
        }
        updateDisplay();
        if (checkWin()) return;
      }
    }

    function checkWin() {
      for (let p = 0; p < 3; p++) {
        if (boards[p][indices[p]].count >= 21) {
          document.getElementById("message").innerHTML = `<strong>${players[p]} wins!</strong>`;
          document.getElementById("beads-remaining").textContent = "";
          return true;
        }
      }
      return false;
    }

    function restartGame() {
      boards = boards.map(() => [
        {label: "Rain", icon: "üåßÔ∏è", count: 0},
        {label: "River", icon: "üåä", count: 0},
        {label: "Clouds", icon: "‚òÅÔ∏è", count: 0}
      ]);
      indices = [0, 0, 0];
      beadsToAdd = 0;
      logEl.innerHTML = "";
      document.getElementById("message").innerHTML = `Your element: <strong>${boards[0][indices[0]].label}</strong>`;
      document.getElementById("beads-remaining").textContent = "";
      updateDisplay();
    }

    function log(msg) {
      logEl.innerHTML += msg + "<br>";
      logEl.scrollTop = logEl.scrollHeight;
    }

    function showModal() {
      document.getElementById("modal").style.display = "flex";
    }

    function hideModal() {
      document.getElementById("modal").style.display = "none";
    }

    for (let i = 0; i < 9; i++) {
      document.getElementById("bowl" + i).onclick = () => addBead(i);
    }

    updateDisplay();
  </script>
</body>
</html>
